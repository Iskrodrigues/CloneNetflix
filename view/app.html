<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <title>App Filmes</title>
    <style>
        pre {
            padding: 20px;
            background: #ccc;
            border-radius: 10px;
            margin: 20px;
        }
    </style>

</head>

<body>
    <div class="container">
        <pre id="debug"></pre>

        <h1>Filmes </h1>
        <form action="" class="jumbotron">
            <div class="row">
                <div class="col-4">
                    <label for="">Titulo</label>
                    <input onkeyup="atualizarDados()" type="text" class="form-control" placeholder="Título" id="titulo">
                </div>
                <div class="col-3">
                    <label for="">Link</label>
                    <input onkeyup="atualizarDados()" type="url" class="form-control" placeholder="URL" id="link">
                </div>
                <div class="col-3">
                    <label for="">Categoria</label>
                    <select id="categoria" onchange="atualizarDados()" name="" class="form-control">
                        <option>Categoria 1</option>
                        <option>Categoria 2</option>
                        <option>Categoria 3</option>
                    </select>
                </div>
                <div class="col-2">
                    <label for="">Ano</label>
                    <input onkeyup="atualizarDados()" type="number" class="form-control" name="" id="ano">
                </div>
            </div>
            <br>
            <a href="javascript:void(0)" onclick="cadastrar()" class=" col-12 btn btn-lg btn-block btn-success">
                Cadastrar Filme
            </a>
        </form>
        <br>

        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">Nome</th>
                    <th scope="col">Categoria</th>
                    <th scope="col">Ano</th>
                    <th scope="col" class="text-right">Ações</th>
                </tr>
            </thead>

            <tbody id="lista_filmes">
                <!-- <tr>
                    <td>Filme teste</td>
                    <td>Categoria 1 </td>
                    <td>2020</td>
                    <td class="text-right col-2">
                        <button class="btn btn-info"> Acessar</button>
                        <button class="btn btn-danger"> Deletar</button>
                    </td>
                </tr> -->
            </tbody>
        </table>
    </div>
</body>

<script type="text/javascript">

    document.addEventListener('click', (e) => {
        const listaClasse = Array.prototype.slice.call(e.target.classList);
        if (e.target && listaClasse.includes('acessarFilme')) {
            const url = e.target.dataset.url;
            window.open(url, '_blank');
        }

        if (e.target && listaClasse.includes('excluirFilme')) {
            const response = confirm('Deseja realmente excluir o filme?');
            if (response) {
                const id = e.target.dataset.id;
                document.getElementById(id).remove();
            }


        }
    });

    let dados = {
        titulo: '',
        categoria: '',
        ano: 0,
        link: '',
    }

    const atualizarDados = () => {
        dados = {
            titulo: document.getElementById('titulo').value,
            categoria: document.getElementById('categoria').value,
            ano: document.getElementById('ano').value,
            link: document.getElementById('link').value,
        }

        document.getElementById('debug').innerHTML = JSON.stringify(dados)
    }

    const montaItem = () => {

        const id = new Date().getTime();

        const item = `
                <tr id="${id}">
                    <td>${dados.titulo}</td>
                    <td>${dados.categoria}</td>
                    <td>${dados.ano}</td>
                    <td class="text-right col-2">
                        <button class="btn btn-info acessarFilme" data-url="${dados.link}"> Acessar</button>
                        <button class="btn btn-danger excluirFilme" data-id="${id}"> Deletar</button>
                    </td>
                    </tr>`;


        return item;
    }

    const cadastrar = () => {
        document.getElementById('lista_filmes').insertAdjacentHTML('beforeEnd', montaItem());
        dados = {};
    }
</script>

</html>